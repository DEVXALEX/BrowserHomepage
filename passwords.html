<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Password Manager</title>

    <!-- Security: Content Security Policy (Anti-XSS) -->
    <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com; img-src 'self' data: https:; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com; connect-src 'self' https://api.github.com;">

    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%234dff88' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><rect x='3' y='11' width='18' height='11' rx='2' ry='2'></rect><path d='M7 11V7a5 5 0 0 1 10 0v4'></path></svg>">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/modules/syncBadge.css">
    <link rel="stylesheet" href="css/pages/passwords.css?v=1">

</head>

<body>
    <div id="global-background"></div>

    <nav id="top-navbar">
        <div class="nav-logo">
            <i class="fa-solid fa-lock"></i>
        </div>
        <ul class="nav-links">
            <li data-action="home">Home</li>
            <li data-action="notes">Notes & Tasks</li>
            <li data-action="calendar">Calendar</li>
            <li data-action="bookmarks">Bookmarks</li>
            <li data-action="passwords" class="active"><i class="fa-solid fa-lock"
                    style="font-size: 0.8rem; margin-right: 5px;"></i>Passwords</li>
        </ul>
        <div class="nav-extra">
            <!-- Space for future additions -->
        </div>
    </nav>

    <main id="password-manager-app">
        <div class="pm-container">
            <!-- Sidebar / Filter -->
            <aside class="pm-sidebar">
                <div class="pm-brand">
                    <i class="fa-solid fa-shield-cat"></i>
                </div>



                <div class="pm-filters">
                    <button class="pm-filter-btn active" data-filter="all">
                        <i class="fa-solid fa-layer-group"></i> All Items
                    </button>
                    <button class="pm-filter-btn" data-filter="favorites">
                        <i class="fa-solid fa-star"></i> Favorites
                    </button>
                </div>


                <!-- Sidebar Actions -->
                <div
                    style="margin-top: auto; width: 100%; display: flex; flex-direction: column; gap: 8px; padding-bottom: 10px;">
                    <button id="pm-change-pass-btn" class="pm-filter-btn" title="Change Master Password">
                        <i class="fa-solid fa-key"></i> Reset Password
                    </button>
                    <button id="pm-lock-btn" class="pm-filter-btn" title="Lock Vault" style="color: #ff6b6b;">
                        <i class="fa-solid fa-lock"></i> Lock Vault
                    </button>

                    <!-- Toggle to Light Mode -->
                    <a href="passwords-light.html" class="pm-filter-btn" title="Switch to Light Mode"
                        style="text-decoration: none; justify-content: flex-start;">
                        <i class="fa-solid fa-sun"></i> Light Mode
                    </a>
                </div>

                <div id="main-sync-badge" title="Cloud Sync Status" class="sync-badge" style="align-self: center;">
                    <i class="fa-solid fa-cloud"></i>
                </div>
            </aside>

            <!-- Main Content Area -->
            <section class="pm-content">
                <header class="pm-header">
                    <div class="pm-search">
                        <i class="fa-solid fa-search"></i>
                        <input type="text" id="pm-search-input" placeholder="Search passwords..." autofocus>
                    </div>
                    <button id="pm-add-btn" class="pm-add-btn" title="Add New Password">
                        <i class="fa-solid fa-plus"></i>
                    </button>
                </header>

                <div id="pm-list-container" class="pm-grid">
                    <!-- Locked State Placeholder -->
                    <div class="pm-locked-state">
                        <i class="fa-solid fa-shield-cat"></i>
                        <h3>Vault is Locked</h3>
                        <p>Enter your Master Password to view your passwords.</p>

                        <div class="pm-inline-auth">
                            <input type="password" id="pm-inline-pin" placeholder="Master Password">
                            <button id="pm-inline-unlock-btn" class="form-btn-save">Unlock</button>
                        </div>
                        <p id="pm-inline-error"
                            style="color: #ff4d4d; margin-top: 10px; height: 20px; font-size: 0.9rem;"></p>
                        <a href="#" id="pm-reset-vault-link"
                            style="color: var(--accent-color); font-size: 0.85rem; margin-top: 1.5rem; text-decoration: none; border-bottom: 1px dashed var(--accent-color); display: inline-block; opacity: 0.8; transition: opacity 0.2s;">
                            Wipe Vault & Start Fresh
                        </a>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- REUSED LOCKER MODAL Structure for Authentication logic -->
    <!-- We hide this initially and use it programmatically via locker.js -->
    <div id="locker-modal" class="modal-backdrop">
        <div class="modal-form"
            style="width: 100%; max-width: 500px; min-height: 300px; display: flex; flex-direction: column;">

            <button id="locker-close-btn"
                style="position: absolute; top: 1rem; right: 1rem; background: none; border: none; color: #888; font-size: 1.2rem; cursor: pointer;">&times;</button>

            <!-- Auth View -->
            <div id="locker-auth-view"
                style="display: flex; flex-direction: column; align-items: center; justify-content: center; flex: 1; padding: 2rem;">
                <i class="fa-solid fa-vault"
                    style="font-size: 3rem; color: var(--accent-color); margin-bottom: 1.5rem;"></i>
                <h3 id="locker-auth-title" style="margin-bottom: 1rem;">Ghost Locker</h3>
                <p id="locker-auth-desc"
                    style="color: var(--text-secondary); margin-bottom: 1.5rem; text-align: center;">Enter Master
                    Password to
                    access cloud secrets.</p>

                <input type="password" id="locker-pin-input" placeholder="Enter Master Password"
                    style="font-size: 1.5rem; letter-spacing: 0.5rem; text-align: center; width: 200px; padding: 0.5rem; border-radius: 8px; border: 1px solid #444; background: #222; color: white; margin-bottom: 1rem;">

                <button id="locker-unlock-btn" class="form-btn-save" style="width: 200px;">Unlock</button>
                <p id="locker-error-msg" style="color: #ff4d4d; font-size: 0.8rem; margin-top: 1rem; height: 1rem;"></p>
            </div>

            <!-- List View (Hidden here because we use the custom page UI instead) -->
            <div id="locker-list-view" style="display: none;"></div>
        </div>
    </div>

    <!-- Add/Edit Password Modal -->
    <div id="pm-edit-modal" class="modal-backdrop">
        <div class="modal-form" style="width: 100%; max-width: 450px;">
            <h3 id="pm-modal-title">Add New Password</h3>
            <input type="hidden" id="pm-edit-id">

            <div class="form-group" style="margin-bottom: 1rem;">
                <label style="display:block; color:#ccc; margin-bottom:0.5rem">Title <span
                        style="color:#ff6b6b">*</span></label>
                <input type="text" id="pm-title-input" placeholder="e.g. Netflix"
                    style="width: 100%; padding: 0.8rem; background: rgba(0,0,0,0.3); border: 1px solid #444; color: white; border-radius: 6px;">
            </div>

            <div class="form-group" style="margin-bottom: 1rem;">
                <label style="display:block; color:#ccc; margin-bottom:0.5rem">Website Link</label>
                <input type="text" id="pm-site-input" placeholder="e.g. https://netflix.com"
                    style="width: 100%; padding: 0.8rem; background: rgba(0,0,0,0.3); border: 1px solid #444; color: white; border-radius: 6px;">
            </div>

            <div class="form-group" style="margin-bottom: 1rem;">
                <label style="display:block; color:#ccc; margin-bottom:0.5rem">Username / Email</label>
                <input type="text" id="pm-user-input" placeholder="user@example.com"
                    style="width: 100%; padding: 0.8rem; background: rgba(0,0,0,0.3); border: 1px solid #444; color: white; border-radius: 6px;">
            </div>

            <div class="form-group" style="margin-bottom: 1.5rem;">
                <label style="display:block; color:#ccc; margin-bottom:0.5rem">Password</label>
                <div style="display: flex; gap: 0.5rem;">
                    <input type="text" id="pm-pass-input" placeholder="Secret123"
                        style="flex: 1; padding: 0.8rem; background: rgba(0,0,0,0.3); border: 1px solid #444; color: white; border-radius: 6px;">
                    <button id="pm-gen-pass-btn"
                        style="background: #444; color: white; border: none; padding: 0 1rem; border-radius: 6px; cursor: pointer;">
                        <i class="fa-solid fa-dice"></i>
                    </button>
                </div>
            </div>

            <div class="form-actions" style="display: flex; justify-content: flex-end; gap: 1rem;">
                <button id="pm-cancel-btn" class="form-btn-cancel">Cancel</button>
                <button id="pm-save-btn" class="form-btn-save">Save</button>
            </div>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div id="pm-config-modal" class="modal-backdrop">
        <div class="modal-form" style="width: 100%; max-width: 400px;">
            <h2 id="pm-config-title">Change Master Password</h2>
            <p style="margin-bottom: 1rem; color: #888; font-size: 0.9rem;">This will update your Vault AND Session Key
                (600,000 rounds PBKDF2).</p>

            <input type="password" id="pm-current-pass" placeholder="Current Password" class="form-input"
                style="margin-bottom: 1rem;">

            <input type="password" id="pm-new-pass" placeholder="New Master Password" class="form-input"
                style="margin-bottom: 0.5rem;">

            <div id="pm-pass-requirements"
                style="margin-bottom: 1rem; font-size: 0.85rem; color: #888; display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
                <div id="req-length" class="req-item"><i class="fa-regular fa-circle"></i> 8+ Characters</div>
                <div id="req-case" class="req-item"><i class="fa-regular fa-circle"></i> Upper & Lowercase</div>
                <div id="req-num" class="req-item"><i class="fa-regular fa-circle"></i> Number (0-9)</div>
                <div id="req-special" class="req-item"><i class="fa-regular fa-circle"></i> Symbol (!@#$)</div>
            </div>

            <input type="password" id="pm-confirm-pass" placeholder="Confirm Password" class="form-input">

            <div class="form-actions" style="margin-top: 1.5rem;">
                <button id="pm-config-cancel" class="form-btn-cancel">Cancel</button>
                <button id="pm-config-save" class="form-btn-save">Change Password</button>
            </div>
        </div>
    </div>

    <!-- Session Unlock Modal (For Secure Token) -->
    <div id="session-unlock-modal" class="modal-backdrop" style="z-index: 2000;">
        <div class="modal-form"
            style="width: 100%; max-width: 400px; display: flex; flex-direction: column; align-items: center; padding: 2rem;">
            <i class="fa-solid fa-shield-halved" style="font-size: 3rem; color: #4dff88; margin-bottom: 1.5rem;"></i>
            <h3 style="margin-bottom: 1rem;">Unlock Session</h3>
            <p style="color: #ccc; margin-bottom: 1.5rem; text-align: center;">Enter your Master Password to enable
                Cloud
                Sync.</p>

            <input type="password" id="session-pin-input" placeholder="Enter Master Password"
                style="font-size: 1.5rem; letter-spacing: 0.5rem; text-align: center; width: 200px; padding: 0.5rem; border-radius: 8px; border: 1px solid #444; background: #222; color: white; margin-bottom: 1.5rem;">

            <button id="session-unlock-btn" class="form-btn-save"
                style="width: 100%; background: #2ea44f; margin-bottom: 1rem;">Unlock</button>

            <button id="session-skip-btn"
                style="background: none; border: none; color: #666; font-size: 0.9rem; cursor: pointer; text-decoration: underline;">Skip
                (Stay Offline)</button>
            <p id="session-error-msg" style="color: #ff4d4d; font-size: 0.8rem; margin-top: 1rem; height: 1rem;"></p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/storage.js?v=2"></script>
    <script src="js/utils.js?v=2"></script>
    <script src="js/modules/crypto.js?v=1"></script>
    <script src="js/modules/navbar.js?v=3"></script>

    <!-- GithubSync is required for Locker authentication -->
    <script src="js/modules/githubSync.js?v=2"></script>

    <script src="js/modules/locker.js?v=2"></script>
    <script src="js/modules/passwordManager.js?v=2"></script>

    <!-- Auto Background Initialization -->
    <script>
        // Simple initialization script for the page
        document.addEventListener('DOMContentLoaded', () => {
            if (window.Homepage) {
                if (window.Homepage.initNavbar) window.Homepage.initNavbar();
                if (window.Homepage.githubSync && window.Homepage.githubSync.init) window.Homepage.githubSync.init();
                if (window.Homepage.Locker && window.Homepage.Locker.init) window.Homepage.Locker.init();
                if (window.Homepage.PasswordManager) window.Homepage.PasswordManager.init();
            }
        });
    </script>
</body>

</html>